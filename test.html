<!DOCTYPE html>
<html ng-app="myApp">

<head>
<title>Dynamic ngMap demo</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="https://maps.google.com/maps/api/js?libraries=placeses,visualization,drawing,geometry,places"></script>
<script src="https://code.angularjs.org/1.3.15/angular.js"></script>
<script src="https://rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.js"></script>
<script src="https://rawgit.com/allenhwkim/angularjs-google-maps/master/testapp/scripts/markerclusterer.js"></script>
<link href="css/custom-marker.css"  rel="stylesheet" />
<script>
var app = angular.module('myApp', ['ngMap']);

app.controller('mapController', function($http, $interval, NgMap) {
	  var vm = this;
	  vm.positions = [];
	  vm.markerCollection = [];
	  vm.grabData = function(){
	  	$http({
	  		//url:"http://localhost:8080/SVN_REPOSIBILITY_HTDOCS/SummerProject/homepage.php?f=grab",
	  		url:"homepage.php?f=grab",
	  		method: "GET",
	  		params:{
	  			date:'sadsad'
	  		}
	  		
	  	}).success(function(data,status,header,config){
	  		//vm.test2 = data;
	  		vm.positions = [];
	  		vm.dynMarkers = [];
	  		var i = 0;
	  		var bounds = new google.maps.LatLngBounds();
	  		for(i = 0; i < data.length; i++){
	  			var marker = new google.maps.Marker({
	                  position: new google.maps.LatLng(data[i][0], data[i][1]),
	                  map: vm.map,
	                  draggable: false,
	                  animation: google.maps.Animation.DROP
	              });
	  			vm.dynMarkers.push(marker);
	  			 bounds.extend(marker.getPosition());
	  		}
	  		//vm.markerClusterer.clearMarkers();
	  		//vm.markerClusterer.addMarkers(vm.map,vm.dynMarkers );
	  		vm.markerClusterer = new MarkerClusterer(vm.map, vm.dynMarkers, {});
	  		vm.map.setCenter(bounds.getCenter());
	  		vm.map.fitBounds(bounds); 
	  		
	  	})
	  	.error(function(data,status,header,config){});
	  }
	    vm.dynMarkers = []
	    NgMap.getMap().then(function(map) {
	    vm.map = map;
	    /* vm.boundsChanged = function(){
	    	vm.ne = this.getBounds().getNorthEast();
	        vm.sw = this.getBounds().getSouthWest();
	        var i;
	        for(i = 0; i < data.length; i++){
	  			if(data[i][0] ){
	  				
	  			}	
	  		}
	    } */
	    
     
   });
});
</script>
</head>

<body ng-controller="mapController as vm">
  <h1>Marker Cluster</h1>
  <hr />
  <button ng-click="vm.grabData()">click me</button>
  <ng-map zoom="8" center="[-37.82238533,145.17729459]"">
  	<shape name="rectangle"					
			        editable="true"
			        draggable="true"
			        bounds="[[-37.82238533,145.17729459],[-37.42238533,145.57729459]]"
			        on-bounds_changed="vm.boundsChanged()">
			      </shape>
    <custom-marker position="[{{p[0]}}, {{p[1]}}]" ng-repeat="p in vm.positions">
      <div class="cm">
      
      </div>
    </custom-marker>
  </ng-map>
  <b>Rectangle moved.</b><br/>
    New north-east corner: {{vm.ne.lat()}}, {{vm.ne.lng()}}<br/>
    New south-west corner: {{vm.sw.lat()}}, {{vm.sw.lng()}}
</body>
</html>
